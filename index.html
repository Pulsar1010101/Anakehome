<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ananke Playlist</title>
    
    <!-- 폰트: Pretendard -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
    
    <!-- 스타일 (Tailwind CSS CDN + Custom) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --surface-color: #1a1a1a;
            --accent-color: #d1d5db;
            --text-secondary: #888888;
        }

        body {
            font-family: "Pretendard Variable", sans-serif;
            background-color: var(--bg-color);
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* 메인 레이아웃 */
        .app-layout {
            display: grid;
            grid-template-columns: 70px 280px minmax(320px, 1fr) 300px;
            height: 100vh;
            width: 100vw;
            min-width: 900px;
            overflow-x: auto;
        }

        /* 1. 메뉴 존 */
        .zone-menu {
            background-color: var(--surface-color);
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 2rem;
            gap: 2rem;
            position: sticky;
            left: 0;
            z-index: 20;
        }
        .menu-item { color: var(--text-secondary); cursor: pointer; transition: color 0.3s; }
        .menu-item:hover, .menu-item.active { color: white; }

        /* 2. 플레이리스트 존 */
        .zone-list {
            background-color: #121212;
            border-right: 1px solid #2a2a2a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .list-header {
            padding: 1.5rem;
            border-bottom: 1px solid #2a2a2a;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .song-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }
        .song-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 4px;
        }
        .song-item:hover { background-color: rgba(255, 255, 255, 0.05); }
        .song-item.active { background-color: rgba(255, 255, 255, 0.15); }
        .song-item img {
            width: 44px; height: 44px;
            border-radius: 4px;
            object-fit: cover;
            flex-shrink: 0;
            background-color: #333;
        }
        .song-info { flex: 1; min-width: 0; }
        .song-info h4 { margin: 0; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500;}
        .song-info p { margin: 2px 0 0; font-size: 0.75rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* 3. 메인 플레이어 존 */
        .zone-player {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #0f0f0f;
            padding: 2rem;
            min-width: 320px;
            overflow: hidden;
            z-index: 10;
        }
        .zone-player::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: var(--player-bg-image);
            background-size: cover;
            background-position: center;
            filter: blur(50px) brightness(0.25);
            transform: scale(1.2);
            z-index: -1;
            transition: background-image 0.5s ease-in-out;
        }

        .album-art-large {
            width: 300px; height: 300px;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            margin-bottom: 2rem;
            object-fit: cover;
            background-color: #222;
        }
        
        .player-info { text-align: center; margin-bottom: 1rem; width: 100%; max-width: 80%; }
        .player-info h1 { 
            font-size: 1.6rem; font-weight: 700; margin-bottom: 0.5rem; 
            cursor: pointer; transition: opacity 0.2s;
            word-break: keep-all; line-height: 1.3;
        }
        .player-info h1:hover { opacity: 0.8; text-decoration: underline; }
        .player-info p { font-size: 1rem; color: #ccc; }

        /* 해시태그 */
        .hashtag-container {
            display: flex; gap: 8px; justify-content: center;
            margin-top: 15px; flex-wrap: wrap;
        }
        .hashtag {
            background-color: rgba(255, 255, 255, 0.08);
            padding: 4px 12px; border-radius: 20px;
            font-size: 0.8rem; color: #d1d5db;
        }

        /* 컨트롤러 */
        .controls { display: flex; align-items: center; gap: 1.5rem; margin-top: 2rem; }
        .btn-control {
            background: none; border: none; color: #aaa; cursor: pointer;
            transition: all 0.2s;
        }
        .btn-control:hover { color: white; transform: scale(1.1); }
        .btn-control:active { transform: scale(0.95); }
        .btn-play {
            width: 60px; height: 60px; border-radius: 50%;
            background-color: white; color: black;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
        }
        .btn-play:hover { color: black; transform: scale(1.05); box-shadow: 0 0 25px rgba(255,255,255,0.3); }

        .progress-container {
            width: 90%; max-width: 500px; margin-top: 2rem;
            display: flex; align-items: center; gap: 10px;
            color: #888; font-size: 0.8rem;
        }
        .progress-bar-bg {
            flex: 1; height: 4px; background: rgba(255,255,255,0.1);
            border-radius: 2px; cursor: pointer; position: relative;
        }
        .progress-bar-fill {
            width: 0%; height: 100%; background: white;
            border-radius: 2px; position: relative;
        }
        
        /* 4. 가사 존 */
        .zone-lyrics {
            background-color: #121212;
            border-left: 1px solid #2a2a2a;
            padding: 2rem;
            overflow-y: auto;
            text-align: center;
            font-size: 0.95rem;
            line-height: 1.8;
            color: #aaa;
            /* 가사 줄바꿈 유지 */
            white-space: pre-wrap; 
            word-break: break-word;
        }
        .lyrics-title {
            font-size: 0.8rem; color: #555;
            margin-bottom: 2rem; text-transform: uppercase;
            letter-spacing: 2px;
            width: 100%;
            text-align: center;
        }
        
        /* YouTube 플레이어 숨김 */
        #youtube-player-container {
            position: absolute;
            top: -9999px;
            left: -9999px;
            width: 360px;
            height: 203px;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div class="app-layout">
        <!-- 1. 메뉴 존 -->
        <nav class="zone-menu">
            <div class="menu-item active" title="홈"><i data-lucide="home" size="24"></i></div>
            <div class="menu-item" title="플레이리스트"><i data-lucide="list-music" size="24"></i></div>
            <div class="menu-item" title="좋아요"><i data-lucide="heart" size="24"></i></div>
            <div style="flex: 1"></div>
            <div class="menu-item" title="설정"><i data-lucide="settings" size="24"></i></div>
        </nav>

        <!-- 2. 리스트 존 -->
        <aside class="zone-list">
            <div class="list-header">Ananke Playlist</div>
            <div class="song-list-container" id="playlist-container"></div>
        </aside>

        <!-- 3. 플레이어 존 -->
        <main class="zone-player" id="player-zone">
            <img src="" alt="Album Art" class="album-art-large" id="main-album-art">
            
            <div class="player-info">
                <h1 id="main-title" title="YouTube에서 보기">곡을 선택하세요</h1>
                <p id="main-artist">-</p>
                <div class="hashtag-container" id="main-hashtags"></div>
            </div>

            <div class="progress-container">
                <span id="current-time">0:00</span>
                <div class="progress-bar-bg" id="progress-bar-bg">
                    <div class="progress-bar-fill" id="progress-bar-fill"></div>
                </div>
                <span id="total-time">0:00</span>
            </div>

            <div class="controls">
                <button class="btn-control" id="btn-shuffle" title="셔플"><i data-lucide="shuffle" size="20"></i></button>
                <button class="btn-control" id="btn-prev" title="이전 곡"><i data-lucide="skip-back" size="28"></i></button>
                <button class="btn-control btn-play" id="btn-play-pause" title="재생/일시정지">
                    <i data-lucide="play" size="28"></i>
                </button>
                <button class="btn-control" id="btn-next" title="다음 곡"><i data-lucide="skip-forward" size="28"></i></button>
                <button class="btn-control" id="btn-repeat" title="반복"><i data-lucide="repeat" size="20"></i></button>
            </div>
        </main>

        <!-- 4. 가사 존 -->
        <aside class="zone-lyrics">
            <div class="lyrics-title">Lyrics / Info</div>
            <div id="lyrics-content" style="color: #666; font-size: 0.9rem;">
                <!-- 가사가 여기에 표시됩니다 -->
                곡을 선택해주세요.
            </div>
        </aside>
    </div>

    <!-- YouTube 플레이어 (숨김) -->
    <div id="youtube-player-container"></div>

    <!-- Lucide 아이콘 라이브러리 -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <script>
        // =========================================================
        // [수정] 33곡 데이터 (가사 입력 가능하도록 변환됨)
        // =========================================================
        // 가사를 넣으려면 각 항목의 lyrics: `...` 백틱 사이에 붙여넣으세요.
        const playlistData = [
            {
                id: 1,
                title: "지금 바로 윤회!",
                artist: "Nakiso",
                link: "https://www.youtube.com/watch?v=3iUgKH8c7p4",
                lyrics: `いますぐ輪廻 今回も結ばれないね
이마 스구 린네 콘카이모 무스바레나이네
지금 바로 윤회, 이번에도 맺어질 수 없네

嘘ついたら針千本 誓って
우소츠이타라 하리 센본 치캇테
거짓말 하면 바늘 천 개, 맹세해줘

ぜったい来世でまた会お？
젯타이 라이세데 마타 아오?
무조건 다음 생에 다시 만나자?

いますぐ輪廻 今回も結ばれないね
이마 스구 린네 콘카이모 무스바레나이네
지금 바로 윤회, 이번에도 맺어질 수 없네

全て捨てて ぽいっ
스베테 스테테 포잇
전부 버려줘, 휙

さらば 生まれ変わる
사라바 우마레카와루
안녕, 다시 태어나

あまりに人生が 憂い
아마리니 진세이가 우이
인생이 너무나도 걱정이야

君の指輪も白紙になって！
키미노 유비와모 하쿠시니 낫테!
너의 반지도 백지가 돼서!

せんぶ消えちゃって、いいよ
젠부 키에찻테, 이이요
전부 사라져버려도, 괜찮아

どうせ生まれ変わって
도오세 우마레카왓테
어차피 다시 태어나서

巡って・出会って
메굿테・데앗테
돌고서・만나

宇宙が爆ぜてしまうまで
우추우가 하제테시마우마데
우주가 터져버릴 때까지

何回も大好きになって
난카이모 다이스키니 낫테
몇 번이고 사랑에 빠져줘

何回も大好きになって
난카이모 다이스키니 낫테
몇 번이고 사랑에 빠져줘

毎回繰り返す身勝手
마이카이 쿠리카에스 미갓테
매번 되풀이돼 제멋대로

何回も大好きになって
난카이모 다이스키니 낫테
몇 번이고 사랑에 빠져줘

ごめんね
고멘네
미안해

『メタモルフォーゼ』
『메타모루훠어제』
『메타모르포제』

いますぐ輪廻 今回も結ばれないね
이마 스구 린네 콘카이모 무스바레나이네
지금 바로 윤회, 이번에도 맺어질 수 없네

嘘ついたら針千本 誓って
우소츠이타라 하리 센본 치캇테
거짓말 하면 바늘 천 개, 맹세해줘

ぜったい来世でまた会お？
젯타이 라이세데 마타 아오?
무조건 다음 생에 다시 만나자?

いますぐ輪廻 今回も結ばれないね
이마 스구 린네 콘카이모 무스바레나이네
지금 바로 윤회, 이번에도 맺어질 수 없네

全て捨てて ぽいっ
스베테 스테테 포잇
전부 버려줘, 휙

だから 生まれ変われ
다카라 우마레카와레
그러니 다시 태어나

間違った人生は 憂い
마치갓타 진세이와 우이
잘못된 인생은 걱정이야

君の隣は私になって？
키미노 토나리와 와타시니 낫테?
너의 곁에는 내가 있어도 될까?

運命よ、跪け
운메이요, 히자마즈케
운명이여, 무릎 꿇어라

いますぐ輪廻 今回も結ばれないね
이마 스구 린네 콘카이모 무스바레나이네
지금 바로 윤회, 이번에도 맺어질 수 없네

いますぐ輪廻 今回は報われないね
이마 스구 린네 콘카이와 무쿠와레나이네
지금 바로 윤회, 이번에는 보답받지 못하네

全て捨てて
스베테 스테테
전부 버려줘

いますぐしんで！
이마스구 신데!
지금 바로 죽어줘!

ファンファーレが鳴って
환화아레가 낫테
팡파르가 울려서

大正解、おめでとう！
다이세이카이, 오메데토오!
완전 정답, 축하해!

ようやく君は救われる
요오야쿠 키미와 스쿠와레루
드디어 너는 구원받아

来世でまた会おう
라이세데 마다 아오오
다음 생에 다시 만나자

いますぐ輪廻 ちょっと苦しんで
이마 스구 린네 촛토 쿠루신데
지금 바로 윤회, 조금 괴로워해줘

ツインレイなんだよ？
츠인 레이난다요?
트윈 레이라구?

早く…
하야쿠…
어서…

ねぇ、私と一つになろう
네에, 와타시토 히토츠니 나로오
있지, 나랑 하나가 되자

さぁ魂の浄化 死への調和
사아 타마시이노 조오카 시에노 초오와
자, 영혼의 정화, 죽음으로의 조화

どうか光になって
도오카 히카리니 낫테
부디 빛이 되어줘

全て捨てて ぽいっ
스베테 스테테 포잇
전부 버려줘, 휙

(출처: http://vocaro.wikidot.com/retry-now)`
            },
            {
                id: 2,
                title: "사기라이프게임",
                artist: "kemu ( 텐진 코토네 커버 )",
                link: "https://www.youtube.com/watch?v=7XbDOwWbAuk",
                lyrics: ``
            },
            {
                id: 3,
                title: "우견의 나비",
                artist: "노리피 ( dongdang 커버 )",
                link: "https://www.youtube.com/watch?v=RsgCoaEy-0U",
                lyrics: ``
            },
            {
                id: 4,
                title: "보랏빛 해바라기",
                artist: "카시이 모이미 ( Ray 커버 )",
                link: "https://www.youtube.com/watch?v=B5X3VlWeUWY",
                lyrics: ``
            },
            {
                id: 5,
                title: "파라디클로로벤젠",
                artist: "OwataP",
                link: "https://www.youtube.com/watch?v=0gUsfig2Gzw",
                lyrics: ``
            },
            {
                id: 6,
                title: "신님태엽감기",
                artist: "kemu( 텐진 코토네 커버 )",
                link: "https://www.youtube.com/watch?v=KONJlE6keqM",
                lyrics: ``
            },
            {
                id: 7,
                title: "노심융해",
                artist: "iroha ( 이세계 정서 커버 )",
                link: "https://www.youtube.com/watch?v=ovJSG_FgyHw",
                lyrics: ``
            },
            {
                id: 8,
                title: "The Truman show - main theme",
                artist: "OST",
                link: "https://www.youtube.com/watch?v=R-WjAOdkU5E",
                lyrics: ``
            },
            {
                id: 9,
                title: "SECRET;WEAPON",
                artist: "Apo11o program",
                link: "https://www.youtube.com/watch?v=XdjPB2V5R5s",
                lyrics: ``
            },
            {
                id: 10,
                title: "Nídhögg",
                artist: "溝口ゆうま",
                link: "https://www.youtube.com/watch?v=0d0sg7RwyDA",
                lyrics: ``
            },
            {
                id: 11,
                title: "호랑나비",
                artist: "포르노 그라피티 ( 마츠나가 이오리 커버 )",
                link: "https://www.youtube.com/watch?v=qQ6e3jd2_rI",
                lyrics: ``
            },
            {
                id: 12,
                title: "기다려줘 피안에서",
                artist: "rinri",
                link: "https://www.youtube.com/watch?v=OCNq16YvLC4",
                lyrics: ``
            },
            {
                id: 13,
                title: "당신밖에 보이지않아!",
                artist: "r-906(dongdang 커버 )",
                link: "https://www.youtube.com/watch?v=CoP2eOOfNiY",
                lyrics: ``
            },
            {
                id: 14,
                title: "황혼 속의 아이",
                artist: "유쿠에렛토",
                link: "https://www.youtube.com/watch?v=oP2BHLvuIXI",
                lyrics: ``
            },
            {
                id: 15,
                title: "뜻대로",
                artist: "r-906(dongdang 커버 )",
                link: "https://www.youtube.com/watch?v=iGO_6gb0gkw",
                lyrics: ``
            },
            {
                id: 16,
                title: "부처님",
                artist: "RADWIMPS( 마후마후 커버 )",
                link: "https://www.youtube.com/watch?v=zaYeKesLkkg",
                lyrics: ``
            },
            {
                id: 17,
                title: "발레리코",
                artist: "미키토P (96네코 커버 )",
                link: "https://www.youtube.com/watch?v=GSa5rBjwcfA",
                lyrics: ``
            },
            {
                id: 18,
                title: "반역의 독침, 테니에라의 추억",
                artist: "Bonsho-Ne",
                link: "https://www.youtube.com/watch?v=UeaO9_0w8Pk",
                lyrics: ``
            },
            {
                id: 19,
                title: "죽기에는 좋은 날이었어",
                artist: "피콘 ( dongdang 커버 )",
                link: "https://www.youtube.com/watch?v=f57IVceA22I",
                lyrics: ``
            },
            {
                id: 20,
                title: "Penguin's Detour",
                artist: "Hayashida ( 獅子神レオナ 커버 )",
                link: "https://www.youtube.com/watch?v=ABvh8q8Y_mM",
                lyrics: ``
            },
            {
                id: 21,
                title: "평생 함께!",
                artist: "키타니 타츠야( 다즈비 커버 )",
                link: "https://www.youtube.com/watch?v=7wBzJGPxA1U",
                lyrics: ``
            },
            {
                id: 22,
                title: "All Alone With you",
                artist: "Egoist",
                link: "https://youtu.be/mOLdLe9b2Sc",
                lyrics: ``
            },
            {
                id: 23,
                title: "몽유병자는 차안에서",
                artist: "키타니 타츠야",
                link: "https://www.youtube.com/watch?v=ymtNhd_3CB8",
                lyrics: ``
            },
            {
                id: 24,
                title: "마법소녀 행복론",
                artist: "토마 ( Kradness 커버 )",
                link: "https://www.youtube.com/watch?v=BqIsWsqMSCQ",
                lyrics: ``
            },
            {
                id: 25,
                title: "반추사고",
                artist: "레루리리 ( 다즈비 커버 )",
                link: "https://youtu.be/dKjYhNsKsH8",
                lyrics: ``
            },
            {
                id: 26,
                title: "Plazma",
                artist: "요네즈켄시( 나츠메 이츠키 커버 )",
                link: "https://www.youtube.com/watch?v=p82eDF3FGDc",
                lyrics: ``
            },
            {
                id: 27,
                title: "연명사고",
                artist: "Neru",
                link: "https://www.youtube.com/watch?v=8OpCkHWnSrA",
                lyrics: ``
            },
            {
                id: 28,
                title: "심혼수",
                artist: "하루노",
                link: "https://www.youtube.com/watch?v=YvZc0g7haiE",
                lyrics: ``
            },
            {
                id: 29,
                title: "다른별에 가자",
                artist: "이요와",
                link: "https://www.youtube.com/watch?v=PubukElqUJw",
                lyrics: ``
            },
            {
                id: 30,
                title: "로워",
                artist: "누유리",
                link: "https://www.youtube.com/watch?v=3sEptl-psU0",
                lyrics: ``
            },
            {
                id: 31,
                title: "살다보면",
                artist: "차지연 ( 구리리 커버 )",
                link: "https://www.youtube.com/watch?v=yba8gFSCQSU",
                lyrics: ``
            },
            {
                id: 32,
                title: "지구의 뒷면",
                artist: "이요와 ( CialA 커버 )",
                link: "https://www.youtube.com/watch?v=PfiNYi0gw4U",
                lyrics: ``
            },
            {
                id: 33,
                title: "Flamingo",
                artist: "요네즈 켄시 ( 다즈비 커버 )",
                link: "https://www.youtube.com/watch?v=DRSniq4NnDc",
                lyrics: ``
            }
        ];

        let currentSongIndex = 0;
        let isPlaying = false;
        let player = null;
        let progressInterval = null;
        let playerReady = false;

        // =========================================================
        // YouTube API 로드
        // =========================================================
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            if(playlistData.length > 0) {
                // 초기화 시 데이터 가공
                playlistData.forEach(item => {
                    // ID 추출
                    let videoId = extractYouTubeId(item.link);
                    item.youtubeId = videoId;
                    
                    // 커버 이미지
                    item.cover = videoId 
                        ? `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`
                        : `https://ui-avatars.com/api/?name=${encodeURIComponent(item.title)}&background=333&color=fff`;

                    // 해시태그 (없으면 자동생성)
                    if (!item.hashtags) {
                        item.hashtags = [];
                        if (item.artist) {
                            const artistName = item.artist.split('(')[0].trim();
                            if (artistName) item.hashtags.push("#" + artistName);
                        }
                    }
                });
                
                // 플레이어 생성
                player = new YT.Player('youtube-player-container', {
                    height: '203',
                    width: '360',
                    videoId: playlistData[0].youtubeId,
                    playerVars: {
                        'playsinline': 1, 'controls': 0, 'disablekb': 1, 'fs': 0, 'rel': 0, 'autoplay': 0
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });

                renderPlaylist();
                loadSongUI(0);
            }
        }

        function onPlayerReady(event) {
            playerReady = true;
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                isPlaying = true;
                updatePlayButton();
                startProgressLoop();
            } else if (event.data == YT.PlayerState.PAUSED) {
                isPlaying = false;
                updatePlayButton();
                stopProgressLoop();
            } else if (event.data == YT.PlayerState.ENDED) {
                isPlaying = false;
                updatePlayButton();
                stopProgressLoop();
                playNext();
            }
        }

        // =========================================================
        // 초기화 및 렌더링
        // =========================================================
        document.addEventListener('DOMContentLoaded', () => {
            // Lucide 아이콘 초기화
            setTimeout(() => { if (typeof lucide !== 'undefined') lucide.createIcons(); }, 100);
        });

        function extractYouTubeId(url) {
            try {
                const urlObj = new URL(url);
                if (urlObj.hostname.includes('youtube.com')) return urlObj.searchParams.get('v');
                else if (urlObj.hostname.includes('youtu.be')) return urlObj.pathname.slice(1).split('?')[0];
            } catch(e) {}
            return "";
        }

        function renderPlaylist() {
            const container = document.getElementById('playlist-container');
            container.innerHTML = '';
            
            playlistData.forEach((song, index) => {
                const div = document.createElement('div');
                div.className = `song-item ${index === currentSongIndex ? 'active' : ''}`;
                div.onclick = () => playSpecificSong(index);
                div.innerHTML = `
                    <img src="${song.cover}" alt="${song.title}" loading="lazy">
                    <div class="song-info">
                        <h4>${song.title}</h4>
                        <p>${song.artist || 'Unknown Artist'}</p>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function loadSongUI(index) {
            if(!playlistData[index]) return;
            const song = playlistData[index];
            
            document.getElementById('main-album-art').src = song.cover;
            
            const titleEl = document.getElementById('main-title');
            titleEl.innerText = song.title;
            titleEl.onclick = () => window.open(song.link, '_blank');
            
            document.getElementById('main-artist').innerText = song.artist || 'Unknown Artist';
            document.getElementById('player-zone').style.setProperty('--player-bg-image', `url('${song.cover}')`);

            const tagBox = document.getElementById('main-hashtags');
            tagBox.innerHTML = song.hashtags.map(t => `<span class="hashtag">${t}</span>`).join('');

            document.querySelectorAll('.song-item').forEach((el, i) => {
                el.classList.toggle('active', i === index);
            });

            // [가사 출력 로직]
            const lyricsContent = document.getElementById('lyrics-content');
            if (song.lyrics && song.lyrics.trim() !== "") {
                // 가사가 있으면 그대로 출력 (white-space: pre-wrap 덕분에 줄바꿈 유지됨)
                lyricsContent.innerHTML = song.lyrics;
                // 가사가 있을 때는 정렬 스타일을 초기화 (왼쪽/중앙 정렬 등 텍스트 흐름대로)
                lyricsContent.style.display = 'block'; 
                lyricsContent.style.textAlign = 'center';
            } else {
                // 가사가 없으면 안내 문구 출력 (중앙 정렬)
                lyricsContent.style.display = 'flex';
                lyricsContent.style.flexDirection = 'column';
                lyricsContent.style.justifyContent = 'center';
                lyricsContent.style.textAlign = 'center';
                lyricsContent.innerHTML = `
                    <div>
                        <strong>${song.title}</strong><br>
                        <span style="color: #888;">${song.artist || 'Unknown Artist'}</span>
                    </div>
                    <div style="margin-top: 2rem; color: #666; font-size: 0.85rem;">
                        등록된 가사가 없습니다.<br>코드를 수정하여 가사를 추가해주세요.
                    </div>
                `;
            }
        }

        // =========================================================
        // 컨트롤러
        // =========================================================
        function playSpecificSong(index) {
            currentSongIndex = index;
            loadSongUI(index);
            if(player && playerReady && playlistData[index].youtubeId) {
                player.loadVideoById(playlistData[index].youtubeId);
                setTimeout(() => player.playVideo(), 100);
            }
        }

        function togglePlay() {
            if (!player || !playerReady) return;
            isPlaying ? player.pauseVideo() : player.playVideo();
        }

        function playNext() {
            currentSongIndex = (currentSongIndex + 1) % playlistData.length;
            playSpecificSong(currentSongIndex);
        }

        function playPrev() {
            currentSongIndex = (currentSongIndex - 1 + playlistData.length) % playlistData.length;
            playSpecificSong(currentSongIndex);
        }

        function updatePlayButton() {
            const btn = document.getElementById('btn-play-pause');
            btn.innerHTML = isPlaying ? '<i data-lucide="pause" size="28"></i>' : '<i data-lucide="play" size="28"></i>';
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function startProgressLoop() {
            stopProgressLoop();
            progressInterval = setInterval(() => {
                if(!player || !player.getCurrentTime) return;
                const current = player.getCurrentTime();
                const duration = player.getDuration();
                if(duration > 0) {
                    const percent = (current / duration) * 100;
                    document.getElementById('progress-bar-fill').style.width = `${percent}%`;
                    document.getElementById('current-time').innerText = formatTime(current);
                    document.getElementById('total-time').innerText = formatTime(duration);
                }
            }, 500);
        }

        function stopProgressLoop() {
            if(progressInterval) clearInterval(progressInterval);
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            return `${m}:${s < 10 ? '0' + s : s}`;
        }

        document.getElementById('btn-play-pause').addEventListener('click', togglePlay);
        document.getElementById('btn-next').addEventListener('click', playNext);
        document.getElementById('btn-prev').addEventListener('click', playPrev);
        
        document.getElementById('progress-bar-bg').addEventListener('click', (e) => {
            if(!player || !playerReady) return;
            const rect = e.currentTarget.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            player.seekTo(player.getDuration() * percent, true);
        });

        document.getElementById('btn-shuffle').addEventListener('click', () => {
            playSpecificSong(Math.floor(Math.random() * playlistData.length));
        });

        document.getElementById('btn-repeat').addEventListener('click', () => {
            if(player && playerReady) {
                player.seekTo(0);
                player.playVideo();
            }
        });
    </script>
</body>
</html>
